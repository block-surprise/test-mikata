<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>テストの味方</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" href="favicon.png" type="image/png">
    <link rel="apple-touch-icon" href="favicon2.png">
      <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3571574988222927" crossorigin="anonymous"></script>
  <meta name="google-adsense-account" content="ca-pub-3571574988222927">
    <style>
        :root { --primary: #fb923c; --bg: #fff7ed; --card: #ffffff; --text: #431407; --accent: #22c55e; }
        body { margin: 0; font-family: sans-serif; background: var(--bg); color: var(--text); padding-bottom: 80px; }
        .hidden { display: none !important; }
        
        /* ヘッダー */
        header { background: var(--primary); color: white; padding: 15px; text-align: center; position: sticky; top: 0; z-index: 100; }
        h1 { margin: 0; font-size: 1.2rem; }

        /* ナビゲーション */
       nav { 
    position: fixed; 
    bottom: 0; 
    left: 0; 
    width: 100%; 
    background: white; 
    display: flex; 
    justify-content: space-around; 
    padding: 10px 0; 
    border-top: 1px solid #ddd; 
    z-index: 1000; 
    height: 60px; 
}
        .nav-item { color: #94a3b8; text-align: center; font-size: 0.7rem; cursor: pointer; flex: 1; }
        .nav-item.active { color: var(--primary); }
        .nav-item i { font-size: 1.4rem; display: block; margin-bottom: 2px; }

        main { padding: 15px; max-width: 500px; margin: 0 auto; box-sizing: border-box; }
        .card { background: var(--card); padding: 15px; border-radius: 15px; margin-bottom: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); border: 1px solid #ffedd5; }

        /* グラフ */
        .chart-container { position: relative; width: 100px; height: 100px; margin: 0 auto 10px; }
        .chart-svg { transform: rotate(-90deg); width: 100%; height: 100%; }
        .chart-bg { fill: none; stroke: #fed7aa; stroke-width: 10; }
        .chart-fill { fill: none; stroke: var(--accent); stroke-width: 10; stroke-linecap: round; transition: stroke-dasharray 0.5s; }
        .chart-text { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 1.2rem; font-weight: bold; }

        /* ストイックボックス */
        .stoic-box { background: #431407; color: white; border-radius: 15px; padding: 12px; margin-bottom: 15px; text-align: center; }
        .timer-display { font-family: monospace; font-size: 1.5rem; margin: 5px 0; color: var(--primary); }
        .stoic-btn { background: var(--primary); color: white; border: none; padding: 6px 15px; border-radius: 20px; font-weight: bold; font-size: 0.8rem; }
        .stoic-btn.active { background: #ef4444; }

        /* 入力系 */
        .input-group { display: flex; gap: 5px; margin-top: 10px; }
        input { flex: 1; padding: 10px; border-radius: 8px; border: 1px solid #cbd5e1; font-size: 16px; min-width: 0; }
        button.action-btn { background: var(--primary); color: white; border: none; border-radius: 8px; font-weight: bold; padding: 10px; }
        
        /* カラーピッカー */
        .color-picker { display: flex; gap: 8px; margin-bottom: 10px; }
        .color-dot { width: 24px; height: 24px; border-radius: 50%; cursor: pointer; border: 2px solid #eee; }
        .color-dot.selected { border-color: #431407; }

        .archive-card { border-left: 5px solid #94a3b8; }

        @media (min-width: 768px) {
    nav { 
        bottom: auto; /* 下固定を解除 */
        top: 0;       /* 上固定に変更 */
        border-top: none; 
        border-bottom: 1px solid #ddd; 
        justify-content: center; 
        gap: 50px; /* アイコン同士の間隔を広げる */
    }
            body { 
        padding-bottom: 0; 
        padding-top: 70px; 
    }
            header {
        margin-top: 10px;
    }
}
    </style>
</head>
<body>

<header><h1><i class="fas fa-pencil-alt"></i> テストの味方</h1></header>

<main id="app">
    <div id="page-home" class="page">
        <div id="home-content"></div>
    </div>

    <div id="page-archive" class="page hidden">
        <h3 style="margin-left:5px;">過去のテスト結果</h3>
        <div id="archive-list"></div>
    </div>

    <div id="page-info" class="page hidden">
        <div class="card">
            <h3><i class="fas fa-circle-info"></i> 使い方</h3>
            <p style="font-size:0.85rem; line-height: 1.6;">
                1. 最初の画面でテスト名と目標日をセット！<br>
                2. 「教材追加」からワークの名前とページ数を登録。<br>
                3. 毎日やった分を「記録」して、グラフを伸ばそう！<br>
                4. テストが終わったら「アーカイブ」へ保存！
            </p>
        </div>
        
        <div class="card">
            <h3><i class="fas fa-shield-halved"></i> プライバシー・規約</h3>
            <div style="font-size:0.75rem; color:#666; line-height: 1.5;">
                <p><strong>■ データの保存について</strong><br>
                入力された学習記録は、あなたの端末（ブラウザ）にのみ保存されます。サーバーへ送信されることはありません。</p>
                
                <p><strong>■ 広告の配信について</strong><br>
                本アプリでは、Google AdSenseを利用して広告を表示する場合があります。その際、利用者に適した広告を表示するために、Cookie（クッキー）を使用することがあります。</p>
                
                <p><strong>■ 利用解析について</strong><br>
                アプリの改善を目的として、Google Analyticsを使用する場合があります。これにより、どの機能がよく使われているかなどの統計データ（個人を特定しないもの）を収集します。</p>
                
                <p><strong>■ 免責事項</strong><br>
                本アプリを利用したことによるトラブルや損害、テストの結果等について、開発者は一切の責任を負いません。計画的に勉強しましょう！</p>
            </div>
        </div>
        
        <button onclick="fullReset()" style="color:#94a3b8; background:none; border:none; font-size:0.7rem; width:100%; margin-top:10px;">データをすべて消去して初期化</button>
    </div>
</main>

<nav>
    <div class="nav-item active" id="nav-home" onclick="showPage('home')"><i class="fas fa-home"></i>ホーム</div>
    <div class="nav-item" id="nav-archive" onclick="showPage('archive')"><i class="fas fa-history"></i>過去ログ</div>
    <div class="nav-item" id="nav-info" onclick="showPage('info')"><i class="fas fa-circle-info"></i>情報</div>
</nav>

<script>
    let plan = JSON.parse(localStorage.getItem('tm_v6_plan'));
    let archives = JSON.parse(localStorage.getItem('tm_v6_archives')) || [];
    let selectedColor = "#fb923c";
    let timerInt, seconds = 0, isStoic = false;

    function showPage(pageId) {
        document.querySelectorAll('.page').forEach(p => p.classList.add('hidden'));
        document.getElementById('page-' + pageId).classList.remove('hidden');
        document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
        document.getElementById('nav-' + pageId).classList.add('active');
        render();
    }

    function toggleStoic() {
        isStoic = !isStoic;
        const btn = document.getElementById('stoic-toggle');
        if(isStoic) {
            btn.innerText = "集中解除"; btn.classList.add('active');
            timerInt = setInterval(() => { seconds++; updateTimerUI(); }, 1000);
        } else {
            clearInterval(timerInt);
            btn.innerText = "修行開始"; btn.classList.remove('active');
            seconds = 0; updateTimerUI();
        }
    }

    function updateTimerUI() {
        const m = String(Math.floor(seconds / 60)).padStart(2, '0');
        const s = String(seconds % 60).padStart(2, '0');
        if(document.getElementById('timer')) document.getElementById('timer').innerText = `00:${m}:${s}`;
    }

    function initPlan() {
        const n = document.getElementById('set-name').value;
        const d = document.getElementById('set-date').value;
        if(n && d) {
            plan = { name: n, date: new Date(d).getTime(), works: [] };
            save();
        }
    }

    function addWork() {
        const n = document.getElementById('wn').value;
        const p = parseInt(document.getElementById('wp').value);
        if(n && p) {
            plan.works.push({ name: n, total: p, done: 0, color: selectedColor });
            save();
        }
    }

    function updateWork(idx, val) {
        const v = parseInt(val);
        if(!isNaN(v)) {
            plan.works[idx].done = Math.min(plan.works[idx].total, plan.works[idx].done + v);
            save();
        }
    }

    function archivePlan() {
        if(confirm("このテストを終了して記録に残しますか？")) {
            archives.push({...plan, endAt: new Date().toLocaleDateString()});
            localStorage.setItem('tm_v6_archives', JSON.stringify(archives));
            plan = null;
            save();
        }
    }

    function save() {
        localStorage.setItem('tm_v6_plan', JSON.stringify(plan));
        render();
    }

    function render() {
        const home = document.getElementById('home-content');
        if(!plan) {
            home.innerHTML = `<div class="card"><h3>新しいテスト計画</h3><input id="set-name" placeholder="テスト名 (例:中間)"><input type="date" id="set-date" style="width:100%; margin:10px 0;"><button onclick="initPlan()" style="width:100%; background:var(--primary); color:white; border:none; padding:12px; border-radius:8px;">作成開始</button></div>`;
        } else {
            const diff = Math.ceil((plan.date - new Date().setHours(0,0,0,0)) / 86400000);
            let tD = 0, tT = 0, tN = 0;
            const worksHtml = plan.works.map((w, i) => {
                const n = Math.max(0, diff > 0 ? Math.ceil((w.total - w.done) / diff) : w.total - w.done);
                tD += w.done; tT += w.total; tN += n;
                return `<div class="card" style="border-left:5px solid ${w.color}">
                    <div style="display:flex; justify-content:space-between; font-weight:bold; font-size:0.9rem;">
                        <span>${w.name} <small style="color:#666; font-weight:normal;">(残${w.total-w.done}P)</small></span>
                        <span style="color:${w.color}">今日:${n}P</span>
                    </div>
                    <div class="input-group">
                        <input type="number" id="in-${i}" placeholder="やったP">
                        <button class="action-btn" onclick="updateWork(${i}, document.getElementById('in-${i}').value)" style="background:${w.color}">記録</button>
                    </div>
                </div>`;
            }).join('');
            const per = tT > 0 ? Math.floor((tD / tT) * 100) : 0;
            home.innerHTML = `
                <div class="visual-summary">
                    <div class="chart-container">
                        <svg class="chart-svg" viewBox="0 0 100 100"><circle class="chart-bg" cx="50" cy="50" r="40"></circle><circle class="chart-fill" cx="50" cy="50" r="40" stroke-dasharray="${per*2.51} 251"></circle></svg>
                        <div class="chart-text">${per}%</div>
                    </div>
                    <p style="font-size:0.8rem; margin:0;">${plan.name} まであと <strong>${diff}</strong> 日</p>
                    <p style="font-size:1.1rem; margin:5px 0;">今日のノルマ: <strong>${tN}</strong> P</p>
                </div>
                <div class="stoic-box">
                    <div id="timer" class="timer-display">00:00:00</div>
                    <button id="stoic-toggle" class="stoic-btn" onclick="toggleStoic()">修行開始</button>
                </div>
                ${worksHtml}
                <div class="card">
                    <h4 style="margin:0 0 10px 0;">教材追加</h4>
                    <div class="color-picker">${['#fb923c','#3b82f6','#ef4444','#22c55e','#a855f7'].map(c=>`<div class="color-dot ${selectedColor===c?'selected':''}" style="background:${c}" onclick="selectedColor='${c}';render()"></div>`).join('')}</div>
                    <div class="input-group"><input id="wn" placeholder="教科名"><input id="wp" type="number" placeholder="全P"><button onclick="addWork()" class="action-btn">＋</button></div>
                    <button onclick="archivePlan()" style="width:100%; margin-top:20px; font-size:0.7rem; background:none; border:none; color:#94a3b8;">テストを終了して保存</button>
                </div>`;
        }

        // アーカイブ描画
        document.getElementById('archive-list').innerHTML = archives.map(a => {
            const sumD = a.works.reduce((s,w)=>s+w.done,0);
            const sumT = a.works.reduce((s,w)=>s+w.total,0);
            const p = sumT > 0 ? Math.floor((sumD/sumT)*100) : 0;
            return `<div class="card archive-card"><strong>${a.name}</strong> <small>(${a.endAt})</small><br><span style="font-size:0.8rem;">進捗: ${p}% (${sumD}/${sumT}P)</span></div>`;
        }).join('') || '<p style="text-align:center; color:#94a3b8;">記録はまだありません</p>';
    }

    function fullReset() { if(confirm("すべてのデータが消えます。")) { localStorage.clear(); location.reload(); } }
    render();
</script>
</body>
</html>
